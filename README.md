[Перейти к Подзаголовку 1.1](#подзаголовок-11)


Техническое задание

Мониторинг

## 1. Дашборд активности пользователей в юпитер (количество операций в день)
## 2. Дашборд по топовым тетрадкам (сколько подъедают).
   
2.1 Для вычисления подъедаемой памяти ноутбуками пришлось воспользоваться самодельным exporter (Благо базовые знания python в сумме с ИИ) родили сей 
[чудо](https://github.com/Zubaev/jupyterhub_docker_postgres/blob/main/notebook_metrics/jupyterhub_notebook_files_metrics.py) на свет, он не идеален в прод врядли пойдет, но я его все равно люблю)))) как он работает можно разобраться по коментариям в самом скрипте

2.2 Вот с активностью пользователей я жестко лоханулся(оставив на последок эту метрику) поверил инТЕРНЕТУ, что jupyterhub экспортирует ее сам напрямую)))) в итоге эта метрика показала всего лишь сколько пользователей заходило в jupyter за день, а так же я смог с нее выташить только количество http запросов. Но крутого результата с количеством запушеных тетрадок я добиться не смог!!!!!
![jupyter](https://github.com/user-attachments/assets/7f9e683e-f394-45a3-a859-d0ee179101d8)



## 4. Дашборд топовых таблиц в постресе с их владельцами

Вот тут была жесткая рубка если честно. ТЯЖЕЛО Х5 я хотел чтобы метрика показывала мне динамику изменения размера таблицы, то есть чтобы я видел когда в нее что то добавляют, нарыл postgres-exporter и информацию, что можно с помощью  
[запроса](https://github.com/Zubaev/jupyterhub_docker_postgres/blob/main/postgres-exporter/queries.yaml) вытянуть любые метрики, но оказалось, что новая версия тянет примитивные метрики, а postgres давно подключается напрямую к Grafana, но меня такой расклад не устроил перелопатил пол инета и нашел, что если взять версию v0.10.0 можно использовать как раз таки наш волшебный файл))) и все заработало!!!!!! На слайдах конечный размер таблиц, а так же Динамика добавления в них данных. Я добавлял туда данные черпез промежутки.
![1 дашборд постгрес](https://github.com/user-attachments/assets/1c9805fa-2e1a-4612-b70a-de6cdc937efd)
![размер таблиц дебивер 2](https://github.com/user-attachments/assets/0c3dbace-0aa8-4fb4-b347-bab08db2a06d)

## 6. Дашборды должны быть публичными (с этим особых проблем нету, но нет финансов для покупки домена)

## С виртуальными машинами, моим ноутбуком и тем как я пару раз хотел уйти в горы пасти баранов отдельная история!!!!!

Почему то у меня дохли виртуальные машины. Пока не отказался от серверной версии в пользу обычной Ублюнты 24.04.1 с графическим интерфейсом (Да не уровень, да колхоз, да ДЕВОПСЫ не поймут, но по другому вообще не работало, стока раз умирали эти без интерфейсные машины, WSL тоже предал меня как дело до CAdvizora дошло)

## 8. Настроить алерт при заходе пользователя на сервер по ssh на почту.

Здесь я воспользовался методом который описан на каждом втором сайте (Даже вконтакте есть статья) единственные изменения которые я внес, это добавил в конечный скрипт отправителя 

![Алерт ssh](https://github.com/user-attachments/assets/d3987bad-17f4-4622-bddb-4a897e64dfc5)


## 9. Настроить почтовый алерт при потребление общим количеством контейнеров мощности более чем на 80 % - алертить.
Вот тут отчаяние достигало 90 %, а не 80))) когда я понял, что нужен Cadvisor, WSL беспомощен, а виртуальные машины не запускаются.
В итоге был получен {пароль приложение} на яндекс почте. сами файлы расположены [тут](https://github.com/Zubaev/jupyterhub_docker_postgres/tree/main/alerts)
![Алерт загрузки ЦПУ](https://github.com/user-attachments/assets/aac5aaa4-8f24-4eb4-894e-c34b4830e004)
